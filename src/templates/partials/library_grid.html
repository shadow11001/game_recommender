<div class="table-responsive">
    <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
            <tr>
                <th style="width: 40%">Title</th>
                <th>Platform</th>
                <th>Playtime</th>
                <th>Status</th>
                <th>Progress (Trophies)</th>
                <th>My Rating</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for game in games %}
            <tr>
                <td>
                    <div class="d-flex align-items-center">
                        {% if game.cover_url %}
                            <img src="{{ game.cover_url.replace('t_thumb', 't_micro') }}" class="rounded me-2" width="32" height="32" style="object-fit: cover;">
                        {% else %}
                            <div class="bg-secondary rounded me-2 d-flex justify-content-center align-items-center text-white" style="width:32px; height:32px; font-size: 0.7rem;">?</div>
                        {% endif %}
                        <div>
                            <div class="fw-bold text-truncate" style="max-width: 300px;" title="{{ game.original_title }}">{{ game.original_title }}</div>
                            <small class="text-muted">{{ game.normalized_title }}</small>
                        </div>
                    </div>
                </td>
                <td>
                    {% for platform in game.platforms %}
                        {% if platform == 'steam' %}<i class="bi bi-steam text-primary" title="Steam"></i>
                        {% elif platform == 'psn' %}<i class="bi bi-playstation text-info" title="PlayStation"></i>
                        {% elif platform == 'xbox' %}<i class="bi bi-xbox text-success" title="Xbox"></i>
                        {% elif platform == 'xbox_pc' %}<i class="bi bi-windows text-success" title="Xbox PC"></i>
                        {% elif platform == 'epic' %}
                            <img src="https://static-assets-prod.epicgames.com/epic-store/static/favicon.ico" width="16" height="16" alt="Epic" title="Epic">
                        {% elif platform == 'gog' %}
                            <img src="https://www.gog.com/favicon.ico" width="16" height="16" alt="GOG" title="GOG">
                        {% else %}<i class="bi bi-controller text-secondary" title="{{ platform }}"></i>{% endif %}
                        {% if not loop.last %}<span class="me-1"></span>{% endif %}
                    {% endfor %}
                </td>
                <td>
                    {% if game.playtime_minutes > 0 %}
                        {{ (game.playtime_minutes / 60) | round(1) }}h
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>
                    <span class="badge 
                        {% if game.manual_play_status == 'completed' %}bg-success
                        {% elif game.manual_play_status == 'playing' or game.manual_play_status == 'played' %}bg-primary
                        {% elif game.manual_play_status == 'dropped' %}bg-danger
                        {% else %}bg-secondary{% endif %}">
                        {{ game.manual_play_status }}
                    </span>
                </td>
                <td hx-trigger="intersect once" hx-get="/api/achievements/{{ game.id }}" hx-swap="innerHTML">
                    {% if game.achievements_total > 0 %}
                        <div class="progress" style="height: 20px; position:relative;">
                            <div class="progress-bar {% if (game.achievements_unlocked/game.achievements_total) > 0.99 %}bg-success{% elif (game.achievements_unlocked/game.achievements_total) > 0.5 %}bg-info{% else %}bg-warning{% endif %}" role="progressbar" style="width: {{ (game.achievements_unlocked / game.achievements_total) * 100 }}%"></div>
                            <small class="position-absolute w-100 text-center fw-bold" style="line-height:20px; color: #444;">{{ game.achievements_unlocked }}/{{ game.achievements_total }}</small>
                        </div>
                    {% else %}
                        <span class="text-muted small">Loading...</span>
                    {% endif %}
                </td>
                <td>
                    {% if game.rating %}
                        <span class="text-warning fw-bold">{{ game.rating }}</span>/10
                    {% else %}
                        <span class="text-muted">-</span>
                    {% endif %}
                </td>
                <td>
                    <button class="btn btn-sm btn-link text-decoration-none" 
                            hx-get="/modal/edit/{{ game.id }}" 
                            hx-target="#edit-modal-content" 
                            data-bs-toggle="modal" 
                            data-bs-target="#editModal">
                        <i class="bi bi-pencil-square"></i>
                    </button>
                    <button class="btn btn-sm btn-link text-decoration-none text-secondary" title="Rematch"
                             hx-get="/modal/rematch/{{ game.id }}"
                             hx-target="#edit-modal-content"
                             data-bs-toggle="modal"
                             data-bs-target="#editModal">
                        <i class="bi bi-link-45deg"></i>
                    </button>
                    <button class="btn btn-sm btn-link text-decoration-none text-danger" title="Delete & Blacklist"
                            hx-delete="/api/game/delete/{{ game.id }}"
                            hx-confirm="Are you sure you want to delete '{{ game.original_title }}'? It will be blacklisted from future syncs."
                            hx-target="closest tr"
                            hx-swap="outerHTML">
                        <i class="bi bi-trash"></i>
                    </button>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="7" class="text-center py-4 text-muted">No games found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
